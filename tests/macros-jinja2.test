- name: Make http request
  tags:
    - request
  preconditions:
    config_files:
      config.http: |
        {% raw %}
        {% import 'macros.jinja2' as macro %}
        {% for i in range(1, 3) %}
        {{ macro.hello(i) }}
        {% endfor %}
        {% endraw %}
      macros.jinja2: |
        {% raw %}
        {% macro hello(number) %}
        - request:
            path: /hello{{ number }}
          response:
            content: <html><body>correct{{ number }}</body></html>
        {% endmacro %}
        {% endraw %}
  scenario:
    - Start services:
        MockHttp:
          - serve
          - config.http
    - Assert request response contains:
        url: http://localhost:10088/hello1
        contains: correct1
    - Assert request response contains:
        url: http://localhost:10088/hello2
        contains: correct2